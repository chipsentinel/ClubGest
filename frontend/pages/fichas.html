<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fichas - Club Gest</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="icon" type="image/png" href="../img/ACG-paint-logo.png">
</head>
<body>
    <!-- HEADER -->
    <header class="header header-club">
        <div class="header-left">
            <img src="../img/ACG-paint-logo.png" alt="Logo Club Gest" class="header-logo">
            <div>
                <h1>Club Gest</h1>
                <p class="header-subtitle">Fichas de Jugadores</p>
            </div>
        </div>
        <div class="header-right">
            <span class="user-info">Admin: <strong>Club Deportivo</strong></span>
            <a href="../index.html" class="btn btn-small btn-danger">Salir</a>
        </div>
    </header>

    <!-- NAVBAR -->
    <nav class="navbar-top">
        <a href="home.html" class="nav-link"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>Inicio</a>
        <a href="convocatorias.html" class="nav-link"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>Convocatorias</a>
        <a href="entrenamientos.html" class="nav-link"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="5" cy="10" r="2.5"></circle><circle cx="19" cy="10" r="2.5"></circle><line x1="8" y1="10" x2="16" y2="10"></line><path d="M7 5v10M17 5v10"></path></svg>Entrenamientos</a>
        <a href="lesiones.html" class="nav-link"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"></path><line x1="12" y1="8" x2="12" y2="16"></line><line x1="8" y1="12" x2="16" y2="12"></line></svg>Lesiones</a>
        <a href="seguros.html" class="nav-link"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>Seguros</a>
        <a href="fichas.html" class="nav-link active"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 3H5c-1 0-2 1-2 2v14c0 1 1 2 2 2h14c1 0 2-1 2-2V5c0-1-1-2-2-2z"></path><path d="M9 7h6M9 11h6M9 15h2"></path></svg>Fichas</a>
    </nav>

    <!-- LAYOUT -->
    <div class="layout">
        <main class="main">
            <div class="page-header">
                <h1><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 3H5c-1 0-2 1-2 2v14c0 1 1 2 2 2h14c1 0 2-1 2-2V5c0-1-1-2-2-2z"></path><path d="M9 7h6M9 11h6M9 15h2"></path></svg>Fichas de Jugadores</h1>
            </div>

            <!-- Checkboxes ocultos para paginación -->
            <input type="radio" id="page1" name="pagination" class="pagination-radio" checked>
            <input type="radio" id="page2" name="pagination" class="pagination-radio">
            <input type="radio" id="page3" name="pagination" class="pagination-radio">
            <input type="radio" id="page4" name="pagination" class="pagination-radio">
            <input type="radio" id="page5" name="pagination" class="pagination-radio">

            <!-- Grid de fichas con paginación CSS -->
            <div class="table-container">
                <div class="fichas-grid" id="fichasGrid">
                    <p style="text-align: center; padding: 2rem;">Cargando jugadores...</p>
                </div>
            </div>

            <!-- Controles de paginación -->
            <div class="pagination-controls">
                <label for="fic-page1" class="btn btn-small btn-info pagination-btn">← ANTERIOR</label>
                <span class="pagination-info">
                    Página <strong class="pagination-page-num">1</strong> de <strong class="pagination-total-pages">1</strong>
                </span>
                <label for="fic-page2" class="btn btn-small btn-info pagination-btn">SIGUIENTE →</label>
            </div>

            <div class="table-info">
                <p>Total registros: <strong>12</strong> fichas | Mostrando: <strong>10</strong> por página</p>
            </div>
        </main>
    </div>

    <!-- FOOTER -->
    <!-- Pie de página con información de copyright y versión del sistema -->
    <footer class="footer">
        <p>&copy; 2025 Club Gest - Sistema de Gestión de Clubes Deportivos</p>
    </footer>

    <script>
        const jugadoresPorPagina = 10;
        let todosLosJugadores = [];

        async function cargarFichas() {
            try {
                const response = await fetch('http://localhost:8080/api/jugadores');
                if (!response.ok) throw new Error('Error cargando jugadores');
                
                todosLosJugadores = await response.json();
                
                if (todosLosJugadores.length === 0) {
                    document.getElementById('fichasGrid').innerHTML = '<p style="text-align: center; padding: 2rem;">No hay jugadores registrados</p>';
                    document.getElementById('totalFichas').textContent = '0';
                    document.getElementById('fichaMostradas').textContent = '0';
                    ocultarControlesPaginacion();
                    return;
                }
                
                // Generar fichas HTML
                generarFichasHTML();
                
                // Actualizar info
                document.getElementById('totalFichas').textContent = todosLosJugadores.length;
                actualizarFichaMostradas();
                
                // Generar controles de paginación
                generarControlesPaginacion();
                
                // Animar
                const fichas = document.querySelectorAll('.ficha-card');
                fichas.forEach((ficha, index) => {
                    ficha.style.animationDelay = `${index * 0.05}s`;
                });
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('fichasGrid').innerHTML = '<p style="text-align: center; padding: 2rem; color: red;">Error al cargar. ¿Está el servidor corriendo?</p>';
            }
        }

        function generarFichasHTML() {
            const fichasGrid = document.getElementById('fichasGrid');
            fichasGrid.innerHTML = '';
            
            todosLosJugadores.forEach((jugador, index) => {
                const pagina = Math.floor(index / jugadoresPorPagina) + 1;
                const fichaHTML = crearFichaHTML(jugador, pagina);
                fichasGrid.innerHTML += fichaHTML;
            });
        }

        function crearFichaHTML(jugador, pagina) {
            const fechaNac = jugador.fechaNacimiento ? new Date(jugador.fechaNacimiento).toLocaleDateString('es-ES') : '-';
            
            return `
                <div class="ficha-card ficha-card-red" data-page="${pagina}">
                    <div class="ficha-header">
                        <h3>ID: ${jugador.id}</h3>
                        <span class="badge badge-danger">Jugador</span>
                    </div>
                    <div class="ficha-body">
                        <p style="font-weight: 600; margin-bottom: 0.5rem;">${jugador.nombre} ${jugador.apellidos || ''}</p>
                        <p><strong>Dorsal:</strong> ${jugador.dorsal || '-'}</p>
                        <p><strong>Posición:</strong> ${jugador.posicion || '-'}</p>
                        <p><strong>Nacimiento:</strong> ${fechaNac}</p>
                        <p><strong>Peso:</strong> ${jugador.peso ? jugador.peso + ' kg' : '-'}</p>
                    </div>
                    <div class="ficha-actions">
                        <button class="btn btn-small btn-info" onclick="verDetalles(${jugador.id})">Ver más</button>
                        <button class="btn btn-small btn-danger" onclick="eliminarJugador(${jugador.id}, '${jugador.nombre} ${jugador.apellidos || ''}')">Eliminar</button>
                    </div>
                </div>
            `;
        }

        function generarControlesPaginacion() {
            const totalPaginas = Math.ceil(todosLosJugadores.length / jugadoresPorPagina);
            
            // Crear nuevos radios si hay más de 5 páginas
            const paginationContainer = document.querySelector('.layout');
            const currentRadios = document.querySelectorAll('.pagination-radio');
            
            if (currentRadios.length < totalPaginas) {
                for (let i = currentRadios.length; i < totalPaginas; i++) {
                    const radio = document.createElement('input');
                    radio.type = 'radio';
                    radio.id = `page${i + 1}`;
                    radio.name = 'pagination';
                    radio.className = 'pagination-radio';
                    paginationContainer.insertBefore(radio, document.querySelector('.main'));
                }
            }
            
            // Actualizar controles visibles
            if (totalPaginas > 1) {
                document.querySelector('.pagination-info').style.display = 'inline-block';
                document.querySelector('.pagination-page-num').textContent = '1';
                document.querySelector('.pagination-total-pages').textContent = totalPaginas;
            } else {
                document.querySelector('.pagination-info').style.display = 'none';
            }
        }

        function actualizarFichaMostradas() {
            const totalPaginas = Math.ceil(todosLosJugadores.length / jugadoresPorPagina);
            if (totalPaginas === 1) {
                document.getElementById('fichaMostradas').textContent = todosLosJugadores.length;
            } else {
                document.getElementById('fichaMostradas').textContent = jugadoresPorPagina;
            }
        }

        function ocultarControlesPaginacion() {
            document.querySelector('.pagination-info').style.display = 'none';
            document.querySelector('.pagination-controls').style.display = 'none';
        }

        function verDetalles(id) {
            alert('Ver detalles del jugador ' + id);
        }

        async function eliminarJugador(id, nombre) {
            if (confirm(`¿Está seguro de que desea eliminar a ${nombre}?`)) {
                try {
                    const response = await fetch(`http://localhost:8080/api/jugadores/${id}`, {
                        method: 'DELETE'
                    });
                    
                    if (response.ok) {
                        alert('Jugador eliminado exitosamente');
                        cargarFichas();
                    } else {
                        alert('Error al eliminar el jugador');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('Error al conectar con el servidor');
                }
            }
        }

        window.onload = cargarFichas;
    </script>

    
</body>
</html>
